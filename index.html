<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Les malheurs de Lulu</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', 'Chalkboard SE', 'Comic Neue', cursive;
            background: linear-gradient(135deg, #FFB6C1 0%, #FFE4E1 50%, #B0E0E6 100%);
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }

        h1 {
            color: #FF69B4;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.2);
            margin-bottom: 30px;
            font-size: 3em;
            text-align: center;
            animation: bounce 2s ease-in-out infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 50px;
            max-width: 1400px;
            width: 100%;
            margin: 0 auto;
            align-items: start;
        }

        .left-section {
            display: flex;
            flex-direction: column;
            gap: 30px;
            align-items: center;
        }

        .right-section {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .wheel-container {
            position: relative;
            width: 540px;
            height: 540px;
            max-width: 90vw;
            max-height: 90vw;
            margin-top: 100px;
        }

        .wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 10px solid #FFD700;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.6),
                        inset 0 0 30px rgba(0, 0, 0, 0.2);
            position: relative;
            transition: transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99);
            background: #fff;
            overflow: hidden;
        }

        .wheel-svg {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 1;
        }

        .wheel-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border-radius: 50%;
            border: 5px solid #fff;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
            z-index: 20;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 1.2em;
            pointer-events: none;
        }

        .pointer {
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 30px solid transparent;
            border-right: 30px solid transparent;
            border-top: 60px solid #FF1493;
            filter: drop-shadow(0 5px 10px rgba(0, 0, 0, 0.3));
            z-index: 5;
        }

        .segment-text {
            position: absolute;
            font-size: 0.95em;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            text-align: center;
            line-height: 1.2;
            transform-origin: center;
            z-index: 2;
            pointer-events: none;
            white-space: nowrap;
            max-width: 40%;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 20px;
            align-items: center;
        }

        .toggle-container {
            display: flex;
            gap: 10px;
            background: white;
            padding: 5px;
            border-radius: 50px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }

        .toggle-btn {
            padding: 10px 30px;
            font-size: 1em;
            background: transparent;
            color: #999;
            transition: all 0.3s ease;
        }

        .toggle-btn.active {
            background: linear-gradient(135deg, #FF69B4, #FF1493);
            color: white;
        }

        .toggle-btn:hover:not(.active) {
            color: #FF69B4;
            transform: scale(1.05);
        }

        button {
            padding: 15px 40px;
            font-size: 1.3em;
            font-weight: bold;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        #spinBtn {
            background: linear-gradient(135deg, #FF69B4, #FF1493);
            color: white;
        }

        #spinBtn:hover:not(:disabled) {
            transform: scale(1.1) rotate(5deg);
            box-shadow: 0 8px 20px rgba(255, 105, 180, 0.4);
        }

        #spinBtn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .result {
            min-height: 80px;
            background: white;
            padding: 20px 40px;
            border-radius: 20px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            font-size: 1.5em;
            font-weight: bold;
            color: #FF1493;
            text-align: center;
            max-width: 600px;
            word-wrap: break-word;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .options-panel {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 600px;
        }

        .options-panel h2 {
            color: #FF69B4;
            margin-bottom: 20px;
            text-align: center;
        }

        .add-option {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .add-option input {
            flex: 1;
            padding: 12px;
            border: 2px solid #FFB6C1;
            border-radius: 10px;
            font-size: 1em;
            font-family: inherit;
        }

        .add-option button {
            padding: 12px 30px;
            font-size: 1em;
            background: linear-gradient(135deg, #87CEEB, #4682B4);
            color: white;
        }

        .add-option button:hover {
            transform: scale(1.05);
        }

        .options-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 300px;
            overflow-y: auto;
        }

        .option-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: #FFF0F5;
            border-radius: 10px;
            border: 2px solid #FFB6C1;
        }

        .option-item span {
            flex: 1;
            color: #FF1493;
            font-weight: bold;
        }

        .option-item button {
            padding: 5px 15px;
            font-size: 0.9em;
            background: #FF6B6B;
            color: white;
        }

        .option-item button:hover {
            background: #FF4444;
            transform: scale(1.05);
        }

        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
                gap: 30px;
            }

            h1 {
                text-align: center;
            }

            .right-section {
                order: -1;
            }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2em;
            }

            .wheel-container {
                width: 350px;
                height: 350px;
            }

            button {
                padding: 12px 30px;
                font-size: 1.1em;
            }

            .result {
                font-size: 1.2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="left-section">
            <h1 id="title">Les malheurs de Lulu</h1>

            <div class="toggle-container">
                <button class="toggle-btn active" id="lucieBtn">Lucie</button>
                <button class="toggle-btn" id="suzanneBtn">Suzanne</button>
            </div>

            <div class="controls">
                <button id="spinBtn">Tourner la roue !</button>
                <div class="result" id="result">Clique pour découvrir ton malheur !</div>
            </div>

            <div class="options-panel">
                <h2>Gérer les options</h2>
                <div class="add-option">
                    <input type="text" id="newOption" placeholder="Ajouter une nouvelle option..." maxlength="50">
                    <button onclick="addOption()">Ajouter</button>
                </div>
                <div class="options-list" id="optionsList"></div>
            </div>
        </div>

        <div class="right-section">
            <div class="wheel-container">
                <div class="pointer"></div>
                <div class="wheel" id="wheel">
                    <div class="wheel-center">LULU</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Current mode: 'lucie' or 'suzanne'
        let currentMode = 'lucie';

        // Default options for Lucie
        const lucieOptions = [
            "Se bloquer le dos",
            "Tomber malade",
            "JP fait des jeanpauleries",
            "Retard d'acompte",
            "J'ai oublié ma tarte au butternut",
            "L'enfant n'a pas dormi",
            "L'enfant a fait pipi au lit",
            "Océane me fait des misères",
            "Geoffroy me fait des misères",
            "François n'a pas le budget",
            "Tout va bien !"
        ];

        // Default options for Suzanne
        const suzanneOptions = [
            "aller manger des churros au Sacré Coeur",
            "s'envoyer en l'air avec un mec qui ressemble à Jason Momoa",
            "danser toute la nuit sur ACDC",
            "visiter le Louvre sans rien voler",
            "faire un escape game spécial film d'horreur",
            "aller manger rue Sainte Anne avec Vincent",
            "manger équilibré (sans parmesan)",
            "s'acheter une planche de surf",
            "faire une dépendaison de crémaillère",
            "laisse tranquille la mozza de chez Leclerc",
            "aller sur le roof top de l'Heron B",
            "boire la bouteille de champagne avec Nico",
            "préparer des mots à emporter pour Sarah et Lucie",
            "s'habiller en couleur"
        ];

        let options = [...lucieOptions];

        // Special option with small probability (5%)
        const SPECIAL_OPTION = "Tout va bien !";
        const SPECIAL_PROBABILITY = 0.02; // 5% chance

        // Colors for wheel segments
        const colors = [
            '#FF69B4', '#87CEEB', '#FFD700', '#98FB98',
            '#FF6B6B', '#DDA0DD', '#F0E68C', '#FFB6C1'
        ];

        let isSpinning = false;
        let currentRotation = 0;

        // Load options from localStorage
        function loadOptions() {
            const savedLucie = localStorage.getItem('rouletteLucieOptions');
            const savedSuzanne = localStorage.getItem('rouletteSuzanneOptions');

            if (savedLucie) {
                const parsed = JSON.parse(savedLucie);
                lucieOptions.length = 0;
                lucieOptions.push(...parsed);
            }

            if (savedSuzanne) {
                const parsed = JSON.parse(savedSuzanne);
                suzanneOptions.length = 0;
                suzanneOptions.push(...parsed);
            }

            // Load current options based on mode
            options = currentMode === 'lucie' ? [...lucieOptions] : [...suzanneOptions];
        }

        // Save options to localStorage
        function saveOptions() {
            if (currentMode === 'lucie') {
                localStorage.setItem('rouletteLucieOptions', JSON.stringify(lucieOptions));
                lucieOptions.length = 0;
                lucieOptions.push(...options);
            } else {
                localStorage.setItem('rouletteSuzanneOptions', JSON.stringify(suzanneOptions));
                suzanneOptions.length = 0;
                suzanneOptions.push(...options);
            }
        }

        // Calculate segment angles based on probabilities
        function calculateSegmentAngles() {
            const segments = [];
            let currentAngle = 0;

            // Check if special option exists (only for Lucie mode)
            const specialIndex = currentMode === 'lucie' ? options.indexOf(SPECIAL_OPTION) : -1;
            const hasSpecial = specialIndex !== -1;

            if (hasSpecial) {
                // Special option gets small angle
                const specialAngle = 360 * SPECIAL_PROBABILITY;
                const remainingAngle = 360 - specialAngle;
                const normalAngle = remainingAngle / (options.length - 1);

                options.forEach((option, index) => {
                    const angle = option === SPECIAL_OPTION ? specialAngle : normalAngle;
                    segments.push({
                        option: option,
                        startAngle: currentAngle,
                        endAngle: currentAngle + angle,
                        angle: angle
                    });
                    currentAngle += angle;
                });
            } else {
                // Equal angles for all
                const angleStep = 360 / options.length;
                options.forEach((option, index) => {
                    segments.push({
                        option: option,
                        startAngle: currentAngle,
                        endAngle: currentAngle + angleStep,
                        angle: angleStep
                    });
                    currentAngle += angleStep;
                });
            }

            return segments;
        }

        // Create wheel segments
        function createWheel() {
            const wheel = document.getElementById('wheel');
            // Clear existing segments (keep center)
            const center = wheel.querySelector('.wheel-center');
            wheel.innerHTML = '';

            // Create SVG for pie slices
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.setAttribute('class', 'wheel-svg');
            svg.setAttribute('viewBox', '0 0 100 100');

            const centerX = 50;
            const centerY = 50;
            const radius = 50;

            const segments = calculateSegmentAngles();

            segments.forEach((segment, index) => {
                const startAngle = (segment.startAngle - 90) * Math.PI / 180;
                const endAngle = (segment.endAngle - 90) * Math.PI / 180;

                // Calculate path coordinates
                const x1 = centerX + radius * Math.cos(startAngle);
                const y1 = centerY + radius * Math.sin(startAngle);
                const x2 = centerX + radius * Math.cos(endAngle);
                const y2 = centerY + radius * Math.sin(endAngle);

                // Create pie slice path
                const largeArcFlag = segment.angle > 180 ? 1 : 0;
                const pathData = `M ${centerX} ${centerY} L ${x1} ${y1} A ${radius} ${radius} 0 ${largeArcFlag} 1 ${x2} ${y2} Z`;

                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', pathData);
                path.setAttribute('fill', colors[index % colors.length]);
                path.setAttribute('stroke', 'rgba(255, 255, 255, 0.3)');
                path.setAttribute('stroke-width', '0.5');

                svg.appendChild(path);

                // Create text element
                const midAngle = ((segment.startAngle + segment.endAngle) / 2 - 90) * Math.PI / 180;
                const textRadius = radius * 0.65;
                const textX = centerX + textRadius * Math.cos(midAngle);
                const textY = centerY + textRadius * Math.sin(midAngle);

                const text = document.createElement('div');
                text.className = 'segment-text';
                text.textContent = segment.option;
                text.style.left = `${textX}%`;
                text.style.top = `${textY}%`;
                // Rotate text to align with radius (perpendicular to the arc)
                const textRotation = (segment.startAngle + segment.endAngle) / 2 + 90;
                text.style.transform = `translate(-50%, -50%) rotate(${textRotation}deg)`;

                wheel.appendChild(text);
            });

            wheel.appendChild(svg);
            wheel.appendChild(center);
        }

        // Spin the wheel
        function spinWheel() {
            if (isSpinning || options.length === 0) return;

            isSpinning = true;
            document.getElementById('spinBtn').disabled = true;
            document.getElementById('result').textContent = 'La roue tourne...';

            // Random spins between 5 and 10 full rotations + random offset
            const minSpins = 5;
            const maxSpins = 10;
            const spins = Math.random() * (maxSpins - minSpins) + minSpins;
            const degrees = spins * 360;

            // Random final position
            const randomDegree = Math.random() * 360;
            const totalRotation = currentRotation + degrees + randomDegree;

            const wheel = document.getElementById('wheel');
            wheel.style.transform = `rotate(${totalRotation}deg)`;
            currentRotation = totalRotation;

            // Calculate result after animation
            setTimeout(() => {
                const normalizedRotation = (360 - (totalRotation % 360)) % 360;
                const segments = calculateSegmentAngles();

                // Find which segment the pointer landed on
                let result = options[0];
                for (let segment of segments) {
                    if (normalizedRotation >= segment.startAngle && normalizedRotation < segment.endAngle) {
                        result = segment.option;
                        break;
                    }
                }

                document.getElementById('result').textContent = `🎉 ${result} !`;
                isSpinning = false;
                document.getElementById('spinBtn').disabled = false;
            }, 4000);
        }

        // Add new option
        function addOption() {
            const input = document.getElementById('newOption');
            const value = input.value.trim();

            if (value && !options.includes(value)) {
                options.push(value);
                saveOptions();
                createWheel();
                updateOptionsList();
                input.value = '';
            }
        }

        // Remove option
        function removeOption(index) {
            const optionToRemove = options[index];

            // Prevent removing the special option (only for Lucie mode)
            if (currentMode === 'lucie' && optionToRemove === SPECIAL_OPTION) {
                alert('Cette option spéciale ne peut pas être supprimée !');
                return;
            }

            if (options.length > 2) {
                options.splice(index, 1);
                saveOptions();
                createWheel();
                updateOptionsList();
            } else {
                alert('Il faut au moins 2 options !');
            }
        }

        // Update options list display
        function updateOptionsList() {
            const list = document.getElementById('optionsList');
            list.innerHTML = '';

            options.forEach((option, index) => {
                const item = document.createElement('div');
                item.className = 'option-item';

                const span = document.createElement('span');
                span.textContent = option;

                const btn = document.createElement('button');
                btn.textContent = 'Supprimer';
                btn.onclick = () => removeOption(index);

                item.appendChild(span);
                item.appendChild(btn);
                list.appendChild(item);
            });
        }

        // Switch mode function
        function switchMode(mode) {
            if (isSpinning) return;

            currentMode = mode;

            // Update toggle buttons
            document.getElementById('lucieBtn').classList.toggle('active', mode === 'lucie');
            document.getElementById('suzanneBtn').classList.toggle('active', mode === 'suzanne');

            // Update title
            const title = document.getElementById('title');
            if (mode === 'lucie') {
                title.textContent = 'Les malheurs de Lulu';
            } else {
                title.textContent = 'Les aventures de Suzanne';
            }

            // Update center text
            const centerText = document.querySelector('.wheel-center');
            centerText.textContent = mode === 'lucie' ? 'LULU' : 'SUSU';

            // Load appropriate options
            options = mode === 'lucie' ? [...lucieOptions] : [...suzanneOptions];

            // Update result text
            if (mode === 'lucie') {
                document.getElementById('result').textContent = 'Clique pour découvrir ton malheur !';
            } else {
                document.getElementById('result').textContent = 'Clique pour découvrir ton aventure !';
            }

            // Recreate wheel and update list
            createWheel();
            updateOptionsList();
        }

        // Allow Enter key to add option
        document.getElementById('newOption').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                addOption();
            }
        });

        // Toggle button events
        document.getElementById('lucieBtn').addEventListener('click', () => switchMode('lucie'));
        document.getElementById('suzanneBtn').addEventListener('click', () => switchMode('suzanne'));

        // Initialize
        loadOptions();
        createWheel();
        updateOptionsList();

        // Spin button event
        document.getElementById('spinBtn').addEventListener('click', spinWheel);
    </script>
</body>
</html>
